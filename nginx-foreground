#!/bin/bash
set -e

NUMBER=$(( $RANDOM % 6 ))
NUMBER_SSL=$(( ($NUMBER+1) % 6 ))

COLORS=(656263 ffd734 0194d2 a0bf37 ed7b0c 004892)
RAND_COLOR=${COLORS[$NUMBER]}
RAND_COLOR_SSL=${COLORS[$NUMBER_SSL]}

F5DEMO_NODENAME=${F5DEMO_NODENAME-"F5 Docker vLab"}
F5DEMO_NODENAME_SSL=${F5DEMO_NODENAME_SSL-$F5DEMO_NODENAME}
F5DEMO_SHORT_NODENAME=${F5DEMO_SHORT_NODENAME-$HOSTNAME}
F5DEMO_COLOR=${F5DEMO_COLOR-$RAND_COLOR}
F5DEMO_COLOR_SSL=${F5DEMO_COLOR_SSL-$RAND_COLOR_SSL}
F5DEMO_BACKEND_URL=${F5DEMO_BACKEND_URL-http://127.0.0.1/backend.shtml}
F5DEMO_APP=${F5DEMO_APP-"index"}
export F5DEMO_NODENAME
export F5DEMO_NODENAME_SSL
export F5DEMO_SHORT_NODENAME
export F5DEMO_COLOR
export F5DEMO_COLOR_SSL
export F5DEMO_BACKEND_URL
export F5DEMO_APP
envsubst '$F5DEMO_NODENAME $F5DEMO_NODENAME_SSL $F5DEMO_COLOR $F5DEMO_COLOR_SSL $F5DEMO_BACKEND_URL $F5DEMO_APP' < /etc/nginx/conf.d/f5demo.template > /etc/nginx/conf.d/f5demo.conf
exec nginx -g "daemon off;"

